templates:
- azure_defender_enabled_description: "Cloudrail will review the Security Center subscription\
    \ pricing configuration in your environment. If the tier is not set to \u201C\
    Standard\u201D for {0} resources, Cloudrail will highlight it as a violation."
- azure_defender_enabled_human_readable_logic: "Cloudrail will review the Security\
    \ Center Subscription Pricing configuration within your Azure subscription and\
    \ Terraform plan to ensure Azure Defender is enabled (\u201CStandard\u201D tier\
    \ pricing) for {0}."
- azure_defender_enabled_console_remediation_steps: Follow the guide at <https://docs.microsoft.com/en-us/azure/security-center/enable-azure-defender>
    in order to enable Azure Defender for {0}.
- azure_defender_enabled_console_remediation_steps_tf: "For the azurerm_security_center_subscription_pricing\
    \ resource, set the tier argument to \u201CStandard\u201D and ensure the resource_type\
    \ argument contains the value \u201C{0}\u201D."
- vm_not_publicly_accessible_name: Ensure VM is not publicly accessible via {0}
- vm_not_publicly_accessible_description: "Having Virtual Machines accessible publicly\
    \ from the Internet on known administrative or management ports can be problematic.\
    \ Cloudraill will attempt to determine if any of the virtual machines are accessible\
    \ directly at their public IP address, or indirectly via NAT, at {0}\u2019s port.\
    \ If they are, a violation will be raised."
- vm_not_publicly_accessible_human_readable_name: "Cloudrail will review the Virtual\
    \ Machines configuration within your Azure subscription and Terraform plan. For\
    \ each virtual machine, it will check the attached network interfaces that are\
    \ reachable from the Internet, either using a public IP or an inbound NAT rule.\
    \ It will ensure that the Network Security Groups of the NIC and the subnet are\
    \ not allowing inbound TCP access to destination port {0}z ({1}, \u201C*\u201D\
    , or a port range containing {1}) for any source IP address prefix (\u201C*\u201D\
    , \u201CInternet\u201D)."
- vm_not_publicly_accessible_console_remediation_steps: Follow the guide at <https://docs.microsoft.com/en-us/azure/virtual-network/manage-network-security-group>
    in order to modify the Network Security Group rule to restrict {0} access from
    the Internet by setting a specific source IP address.
- vm_not_publicly_accessible_iac_remediation_steps: Follow the guide at <https://docs.microsoft.com/en-us/azure/virtual-network/manage-network-security-group>
    in order to modify the Network Security Group rule to restrict {0} access from
    the Internet by setting a specific source IP address.

rules_metadata:
- cloud_provider: azure
  description: "Cloudrail will review settings of all of the database servers configured\
    \ in Azure through the \"Azure Database for \u2026\" functionality. If a database\
    \ server is set to be public, Cloudrail will highlight it as a violation."
  human_readable_logic: Cloudrail will review all of the Azure database servers declared
    in Terraform, and those already existing in the Azure environment, to determine
    if any of them is set to have public access enabled.
  name: Ensure Azure database server is not set to be public
  remediation_steps:
    console: Follow the guides at <https://docs.microsoft.com/en-us/azure/azure-sql/database/connectivity-settings>,
      <https://docs.microsoft.com/en-us/azure/postgresql/howto-deny-public-network-access>,
      <https://docs.microsoft.com/en-us/azure/mysql/howto-deny-public-network-access>,
      <https://docs.microsoft.com/en-us/azure/mariadb/howto-deny-public-network-access>,
      in order to disable public network access for the database.
    terraform: In the database server resource (such as azurerm_postgresql_server,
      azurerm_mssql_server, etc.), set public_network_access_enabled to false.
  resource_type:
  - database
  rule_id: non_car_azure_database_public_access
  rule_type: non_context_aware
  security_layer: networking
  severity: major
- cloud_provider: azure
  description: Network Security Groups should be maintained carefully, in order to
    provide network access for desired entities. Having unused Network Security Groups
    is giving the opportunity to accidentally assign vulnerable network access to
    your resources.
  human_readable_logic: Cloudrail will review all of the Network Security Groups defined
    in your subscription. For each Network Security Group which is present, but not
    attached to any network interfaces, Cloudrail will raise a violation.
  name: Ensure no unused Network Security Group exists in the subscription
  remediation_steps:
    console: Delete the unused Network Security Group from your Azure Portal.
    terraform: Remove the unused azurerm_network_security_group resource, from your
      TF template.
  resource_type:
  - compute
  rule_id: non_car_unused_network_security_group
  rule_type: non_context_aware
  security_layer: networking
  severity: medium
- cloud_provider: azure
  description: Cloudrail will review the Function App configuration in your environment.
    If a function app has FTP enabled and it is not enforcing FTPS only, Cloudrail
    will highlight it as a violation.
  human_readable_logic: Cloudrail will review the Function Apps configuration within
    your Azure subscription and Terraform plan to check if they are enforcing FTPS
    only or if they have FTP disabled.
  name: Ensure Function App enforces FTPS only
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/app-service/deploy-ftp?tabs=portal#enforce-ftps>
      in order to select FTPS Only in FTP state.
    terraform: For the azurerm_function_app resource, set the site_config block with
      ftps_state argument set to "FtpsOnly".
  resource_type:
  - compute
  rule_id: non_car_function_app_enforces_ftps_only
  rule_type: non_context_aware
  security_layer: networking
  severity: medium
- cloud_provider: azure
  description: Cloudrail will review the App service configuration in your environment.
    If an app has FTP enabled and is not enforcing FTPS only, Cloudrail will highlight
    it as a violation.
  human_readable_logic: Cloudrail will review the App services configuration within
    your Azure subscription and Terraform plan to check if they are enforcing FTPS
    only or if they have FTP disabled.
  name: FTPS should be required in your Web App
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/app-service/deploy-ftp?tabs=portal#enforce-ftps>
      in order to disable FTP or select FTPS Only in FTP state.
    terraform: "For the azurerm_app_service resource, set the site_config block with\
      \ ftps_state argument set to \u201CFtpsOnly\u201D to enforce FTPS or to \u201C\
      Disabled\u201D if you want to disable FTP."
  resource_type:
  - compute
  rule_id: non_car_ftps_should_be_required_in_web_app
  rule_type: non_context_aware
  security_layer: networking
  severity: medium
- cloud_provider: azure
  description: Cloudrail will review the Function Apps configuration in your environment.
    If a function does not have authentication enabled, Cloudrail will highlight it
    as a violation.
  human_readable_logic: Cloudrail will review the Function Apps configuration within
    your Azure subscription and Terraform plan to check if authentication is enabled.
  name: Ensure authentication is enabled in Function Apps
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/azure-functions/functions-how-to-use-azure-function-app-settings?tabs=portal#auth>
      in order to enable authentication for the Function App.
    terraform: For the azurerm_function_app resource, set the auth_settings block
      with enabled argument set to true.
  resource_type:
  - compute
  rule_id: non_car_authentication_enabled_in_function_app
  rule_type: non_context_aware
  security_layer: networking
  severity: medium
- cloud_provider: azure
  description: The Azure VPN Gateway has different SKUs to choose from, each with
    different capabilities. The "basic" one is lacking many features and will generally
    not support anything beyond the smallest load.
  human_readable_logic: Cloudrail will review all of the VPN gateways in your Azure
    environment. If any uses the "basic" SKU, Cloudrail will raise a violation.
  name: Ensure Azure VPN gateways don't use the basic SKU
  remediation_steps:
    console: Change the SKU of the VPN gateway by deleting the old one and creating
      a new one with a different SKU.
    terraform: Change the 'sku' in the azurerm_virtual_network_gateway to a value
      that is not "Basic".
  resource_type:
  - network
  rule_id: non_car_vpn_gateway_disallow_basic_sku
  rule_type: non_context_aware
  security_layer: networking
  severity: medium
- cloud_provider: azure
  description: Cloudrail will review the Security Center Auto Provisioning configuration
    in your environment. If the auto provision of the Log Analytics agent is not set
    to On, Cloudrail will highlight it as a violation.
  human_readable_logic: Cloudrail will review the Function Apps configuration within
    your Azure subscription and Terraform plan to check if authentication is enabled.
  name: Ensure Auto provisioning of the Log Analytics agent is enabled on your subscription
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/security-center/security-center-enable-data-collection#enable-auto-provisioning-of-the-log-analytics-agent-and-extensions->
      in order to enable the automatic provision of the Log Analytics agent.
    terraform: "For the azurerm_security_center_auto_provisioning resource, set the\
      \ auto_provision argument to \u201COn\u201D."
  resource_type:
  - security_services
  rule_id: non_car_auto_provisioning_log_analytics_agent_enabled
  rule_type: non_context_aware
  security_layer: logging
  severity: medium
- cloud_provider: azure
  description: Cloudrail will review the Function Apps configuration in your environment.
    If a function does not have client certificates mode set to Required, Cloudrail
    will highlight it as a violation.
  human_readable_logic: Cloudrail will review the Function Apps configuration within
    your Azure subscription and Terraform plan to ensure client certificates are required.
  name: Ensure client certificates are required in Function App
  remediation_steps:
    console: Follow the guide at https://docs.microsoft.com/en-us/azure/app-service/app-service-web-configure-tls-mutual-auth
      in order to require client certificates for Function App.
    terraform: For the azurerm_function_app resource, set the client_cert_mode argument
      to "Required".
  resource_type:
  - compute
  rule_id: non_car_client_certificates_required_in_function_app
  rule_type: non_context_aware
  security_layer: networking
  severity: medium
- cloud_provider: azure
  description: Cloudrail will review the App Service (Function Apps) configuration
    in your environment. If an app does not use the latest HTTP version, Cloudrail
    will highlight it as a violation.
  human_readable_logic: Cloudrail will review the Function Apps configuration within
    your Azure subscription and Cloudrail will review the App Service configuration
    within your Azure subscription and Terraform plan to check if latest http version
    is configured for web apps.
  name: Ensure HTTP version is the latest in Function Apps
  remediation_steps:
    console: Follow the guide at <https://azure.microsoft.com/en-us/blog/announcing-http-2-support-in-azure-app-service/>
      in order to configure HTTP version for the web app.
    terraform: For the azurerm_function_app resource, set the site_config block with
      http2_enabled argument set to true.
  resource_type:
  - compute
  rule_id: non_car_http_latest_in_function_app
  rule_type: non_context_aware
  security_layer: iam
  severity: medium
- cloud_provider: azure
  description: Cloudrail will review the Function Apps configuration in your environment.
    If a function does not use the latest Azure supported TLS version (1.2), Cloudrail
    will highlight it as a violation.
  human_readable_logic: Cloudrail will review the Function Apps configuration within
    your Azure subscription and Terraform plan to ensure they are using the latest
    Azure supported TLS version (1.2).
  name: Ensure Function App is using the latest Azure supported TLS version (1.2)
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/app-service/configure-ssl-bindings#enforce-tls-versions>
      in order to set the Minimum TLS Version to 1.2 for the Function App.
    terraform: "For the azurerm_function_app resource, in site_config block, set the\
      \ min_tls_version argument to \u201C1.2\u201D."
  resource_type:
  - compute
  rule_id: non_car_function_app_using_latest_tls_version
  rule_type: non_context_aware
  security_layer: encryption
  severity: major
- cloud_provider: azure
  description: Cloudrail will review the Security Center configuration in your environment.
    If email notification of high severity alerts is not enabled, Cloudrail will highlight
    it as a violation.
  human_readable_logic: Cloudrail will review the Security Center Contact configuration
    within your Azure subscription and Terraform plan to ensure email notifications
    of security alerts is enabled.
  name: Ensure Email notification for high severity alerts is enabled
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/security-center/security-center-provide-security-contact-details>
      in order to enable email notifications for security alerts.
    terraform: For the azurerm_security_center_contact resource, set the alert_notifications
      argument to true.
  resource_type:
  - security_services
  rule_id: non_car_email_notification_high_severity_alerts_enabled
  rule_type: non_context_aware
  security_layer: logging
  severity: medium
- cloud_provider: azure
  description: Cloudrail will review the PostgreSQL servers configuration in your
    environment. If a server is not enforcing SSL connections, Cloudrail will highlight
    it as a violation.
  human_readable_logic: Cloudrail will review the PostgreSQL Servers configuration
    within your Azure subscription and Terraform plan to ensure that SSL enforcement
    is enabled.
  name: Ensure PostgreSQL Servers are enforcing SSL
  remediation_steps:
    console: "Follow the guide at <https://docs.microsoft.com/en-us/azure/postgresql/concepts-ssl-connection-security>\
      \ in order to enable \u201CEnforce SSL connection\u201D for the PostgreSQL server."
    terraform: For the azurerm_postgresql_server resource, set the ssl_enforcement_enabled
      argument to true.
  resource_type:
  - database
  rule_id: non_car_postgresql_server_enforcing_ssl
  rule_type: non_context_aware
  security_layer: encryption
  severity: major
- cloud_provider: azure
  description: Cloudrail will review the MySQL servers configuration in your environment.
    If a server is not enforcing SSL connections, Cloudrail will highlight it as a
    violation.
  human_readable_logic: Cloudrail will review the MySQL Servers configuration within
    your Azure subscription and Terraform plan to ensure that SSL enforcement is enabled.
  name: Ensure MySQL Servers are enforcing SSL
  remediation_steps:
    console: "Follow the guide at <https://docs.microsoft.com/en-us/azure/mysql/howto-configure-ssl#step-3--enforcing-ssl-connections-in-azure>\
      \ in order to enable \u201CEnforce SSL connection\u201D for the MySQL server."
    terraform: For the azurerm_mysql_server resource, set the ssl_enforcement_enabled
      argument to true.
  resource_type:
  - database
  rule_id: non_car_mysql_server_enforcing_ssl
  rule_type: non_context_aware
  security_layer: encryption
  severity: major
- cloud_provider: azure
  description: Cloudrail will review the App Service (Web Apps) configuration in your
    environment. If an app does not have authentication enabled, Cloudrail will highlight
    it as a violation.
  human_readable_logic: Cloudrail will review the App Service configuration within
    your Azure subscription and Terraform plan to check if authentication is enabled
    for web apps.
  name: Ensure authentication is enabled in Web Apps
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/app-service/overview-authentication-authorization>
      in order to enable authentication for the web app.
    terraform: For the azurerm_app_service resource, set the auth_settings block with
      enabled argument set to true.
  resource_type:
  - compute
  rule_id: non_car_authentication_enabled_in_web_app
  rule_type: non_context_aware
  security_layer: iam
  severity: medium
- cloud_provider: azure
  description: Cloudrail will review the Storage Accounts configuration in your environment.
    If the account network rules are not denying default network access, Cloudrail
    will highlight it as a violation.
  human_readable_logic: Cloudrail will review the Storage Account configuration within
    your Azure subscription and Terraform plan to ensure that its network rules (either
    defined in-line or using azurerm_storage_account_network_rules resource) are denying
    default network access.
  name: Ensure Storage Account has default network access denied
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/storage/common/storage-network-security?tabs=azure-portal#change-the-default-network-access-rule>
      in order to deny access by default.
    terraform: "For the azurerm_storage_account resource, in the network_rules block,\
      \ set the default_action argument to \u201CDeny\u201D. If azurerm_storage_account_network_rules\
      \ resource is being used, set the default_action argument to \u201CDeny\u201D\
      ."
  resource_type:
  - storage
  rule_id: non_car_storage_account_default_network_access_denied
  rule_type: non_context_aware
  security_layer: networking
  severity: medium
- cloud_provider: azure
  description: Cloudrail will review the Function Apps configuration in your environment.
    If a function does not have HTTPS only enabled, Cloudrail will highlight it as
    a violation.
  human_readable_logic: Cloudrail will review the Function Apps configuration within
    your Azure subscription and Terraform plan to check if HTTPS only is enabled.
  name: Ensure Function App is only accessible via HTTPS
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/app-service/configure-ssl-bindings#enforce-https>
      in order to configured HTTPS Only for the Function App.
    terraform: For the azurerm_function_app resource, set the https_only argument
      to true.
  resource_type:
  - compute
  rule_id: non_car_function_app_accessible_only_via_https
  rule_type: non_context_aware
  security_layer: encryption
  severity: medium
- cloud_provider: azure
  description: Cloudrail will review the Web Apps configuration in your environment.
    If a function does not have HTTPS only enabled, Cloudrail will highlight it as
    a violation.
  human_readable_logic: Cloudrail will review the Web Apps configuration within your
    Azure subscription and Terraform plan to check if HTTPS only is enabled.
  name: Ensure Web App is only accessible via HTTPS
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/app-service/configure-ssl-bindings#enforce-https>
      in order to configured HTTPS Only for the Web App.
    terraform: For the azurerm_app_service resource, set the https_only argument to
      true.
  resource_type:
  - compute
  rule_id: non_car_web_app_accessible_only_via_https
  rule_type: non_context_aware
  security_layer: encryption
  severity: medium
- cloud_provider: azure
  description: "Having \u2018auditing\u2019 enabled on SQL servers would help to track\
    \ database activities. Cloudrail will review the MS SQL servers configuration\
    \ in your environment and if a server does not have an auditing policy configured,\
    \ Cloudrail will highlight it as a violation."
  human_readable_logic: Cloudrail will review the SQL servers configuration within
    your Azure subscription and Terraform plan to ensure that auditing is enabled.
  name: Ensure SQL servers have auditing enabled
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/azure-sql/database/auditing-overview>
      in order to configure auditing for SQL servers.
    terraform: For the azurerm_mssql_server resource, add the extended_auditing_policy
      block and set the retention_in_days argument to 0 (unlimited) or a value greater
      than 90 and set the log_monitoring_enabled argument to true if you wish to send
      audit logs to Azure Monitor. If using the azurerm_mssql_server_extended_auditing_policy
      resource, create it with the same previous arguments.
  resource_type:
  - database
  rule_id: non_car_sql_servers_auditing_enabled
  rule_type: non_context_aware
  security_layer: logging
  severity: medium
- cloud_provider: azure
  description: Cloudrail will review the Web Apps configuration in your environment.
    If an app does not use the latest Azure supported TLS version (1.2), Cloudrail
    will highlight it as a violation.
  human_readable_logic: Cloudrail will review the Web Apps configuration within your
    Azure subscription and Terraform plan to ensure they are using the latest Azure
    supported TLS version (1.2).
  name: Ensure Web App is using the latest Azure supported TLS version (1.2)
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/app-service/configure-ssl-bindings#enforce-tls-versions>
      in order to set the Minimum TLS Version to 1.2 for the Web App.
    terraform: For the azurerm_app_service resource, in site_config block, set the
      min_tls_version argument to 1.2.
  resource_type:
  - compute
  rule_id: non_car_web_app_using_latest_tls_version
  rule_type: non_context_aware
  security_layer: encryption
  severity: major
- cloud_provider: azure
  description: Cloudrail will review the Storage Accounts configuration in your environment.
    If an account is not requiring secure transfer (HTTPS), Cloudrail will highlight
    it as a violation.
  human_readable_logic: Cloudrail will review the Storage Account configuration within
    your Azure subscription and Terraform plan to ensure that secure transfer is enabled.
  name: Ensure Storage Account requires secure transfer
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/storage/common/storage-require-secure-transfer>
      in order to enable secure transfer.
    terraform: For the azurerm_storage_account resource, set the enable_https_traffic_only
      argument to true.
  resource_type:
  - storage
  rule_id: non_car_storage_account_secure_transfer
  rule_type: non_context_aware
  security_layer: encryption
  severity: medium
- cloud_provider: azure
  description: Cloudrail will review the Storage Accounts configuration in your environment.
    If an account is allowing public access to containers and blobs, Cloudrail will highlight it as a violation.
  human_readable_logic: Cloudrail will review the Storage Account configuration within your Azure subscription and Terraform plan to ensure that public access is disabled.
  name: Ensure Storage Account does not allow public access
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-configure?tabs=portal#allow-or-disallow-public-read-access-for-a-storage-account>
      in order to set Blob public access to Disabled.
    terraform: For the azurerm_storage_account resource, set the allow_blob_public_access argument to false.
  resource_type:
    - storage
  rule_id: non_car_storage_account_public_access
  rule_type: non_context_aware
  security_layer: networking
  severity: medium
- cloud_provider: azure
  description:
    params:
    - Container Registries
    template: azure_defender_enabled_description
  human_readable_logic:
    params:
    - Container Registries
    template: azure_defender_enabled_human_readable_logic
  name: Ensure Azure Defender for container registries is enabled
  remediation_steps:
    console:
      params:
      - Container Registries
      template: azure_defender_enabled_console_remediation_steps
    terraform:
      params:
      - ContainerRegistry
      template: azure_defender_enabled_console_remediation_steps_tf
  resource_type:
  - security_services
  rule_id: non_car_azure_defender_for_container_registries_enabled
  rule_type: non_context_aware
  security_layer: networking
  severity: major
- cloud_provider: azure
  description: Cloudrail will review the Key Vaults configuration in your environment.
    If a vault does not have purge protection enabled, Cloudrail will highlight it
    as a violation. Cloudrail does not access the contents of the vaults themselves.
  human_readable_logic: Cloudrail will review the Key Vault configuration within your
    Azure subscription and Terraform plan to ensure purge protection is enabled.
  name: Ensure Key Vaults have purge protection enabled
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/key-vault/general/soft-delete-overview>
      in order to enable purge protection for a vault.
    terraform: For the azurerm_key_vault resource, set the purge_protection_enabled
      argument to true.
  resource_type:
  - security_services
  rule_id: non_car_key_vault_purge_protection_enabled
  rule_type: non_context_aware
  security_layer: disaster_recovery
  severity: medium
- cloud_provider: azure
  description:
    params:
    - Sql Servers
    template: azure_defender_enabled_description
  human_readable_logic:
    params:
    - Sql Servers
    template: azure_defender_enabled_human_readable_logic
  name: Ensure Azure Defender for Azure SQL Database servers is enabled
  remediation_steps:
    console:
      params:
      - Sql Servers
      template: azure_defender_enabled_console_remediation_steps
    terraform:
      params:
      - SqlServers
      template: azure_defender_enabled_console_remediation_steps_tf
  resource_type:
  - security_services
  rule_id: non_car_azure_defender_for_azure_sql_servers_enabled
  rule_type: non_context_aware
  security_layer: networking
  severity: major
- cloud_provider: azure
  description:
    params:
    - Kubernetes
    template: azure_defender_enabled_description
  human_readable_logic:
    params:
    - Kubernetes
    template: azure_defender_enabled_human_readable_logic
  name: Ensure Azure Defender for Kubernetes is enabled
  remediation_steps:
    console:
      params:
      - Kubernetes
      template: azure_defender_enabled_console_remediation_steps
    terraform:
      params:
      - KubernetesService
      template: azure_defender_enabled_console_remediation_steps_tf
  resource_type:
  - security_services
  rule_id: non_car_azure_defender_for_kubernetes_enabled
  rule_type: non_context_aware
  security_layer: networking
  severity: major
- cloud_provider: azure
  description:
    params:
    - Storage
    template: azure_defender_enabled_description
  human_readable_logic:
    params:
    - Storage
    template: azure_defender_enabled_human_readable_logic
  name: Ensure Azure Defender for Storage is enabled
  remediation_steps:
    console:
      params:
      - Storage
      template: azure_defender_enabled_console_remediation_steps
    terraform:
      params:
      - StorageAccounts
      template: azure_defender_enabled_console_remediation_steps_tf
  resource_type:
  - security_services
  rule_id: non_car_azure_defender_for_storage_enabled
  rule_type: non_context_aware
  security_layer: networking
  severity: major
- cloud_provider: azure
  description:
    params:
    - Servers
    template: azure_defender_enabled_description
  human_readable_logic:
    params:
    - Servers
    template: azure_defender_enabled_human_readable_logic
  name: Ensure Azure Defender for Servers is enabled
  remediation_steps:
    console:
      params:
      - Servers
      template: azure_defender_enabled_console_remediation_steps
    terraform:
      params:
      - VirtualMachines
      template: azure_defender_enabled_console_remediation_steps_tf
  resource_type:
  - security_services
  rule_id: non_car_azure_defender_for_servers_enabled
  rule_type: non_context_aware
  security_layer: networking
  severity: major
- cloud_provider: azure
  description: Cloudrail will review the Key Vault configuration in your environment.
    If a vault does not have diagnostic logs enabled, Cloudrail will highlight it
    as a violation.
  human_readable_logic: Cloudrail will review the Security Center Contact configuration
    within your Azure subscription and Terraform plan to ensure email notifications
    of security alerts is enabled.
  name: Ensure Key Vault has diagnostic logs enabled
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/key-vault/general/alert>
      in order to enable diagnostic logs for Key Vault.
    terraform: Create an azurerm_monitor_diagnostic_setting resource and set the target_resource_id
      to the Key Vault ID. In the log block, set the enabled argument to true. In
      log block, retention_policy block, set enabled argument to true and days argument
      to 0 (indefinitely) or a value greater than or equal to 365.
  resource_type:
  - security_services
  rule_id: car_key_vault_diagnostic_logs_enabled
  rule_type: context_aware
  security_layer: logging
  severity: medium
- cloud_provider: azure
  description: Cloudrail will review the Storage Accounts configuration in your environment.
    If the account network rules are not allowing access to trusted Azure services,
    Cloudrail will highlight it as a violation.
  human_readable_logic: Cloudrail will review the Storage Account configuration within
    your Azure subscription and Terraform plan to ensure that trusted Azure services
    have network access to the account.
  name: Ensure Storage Account is allowing network access to trusted Azure services
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/storage/common/storage-network-security?tabs=azure-portal#grant-access-to-trusted-azure-services>
      in order to grant access to trusted Azure services.
    terraform: "For the azurerm_storage_account resource, in the network_rules block,\
      \ set the bypass argument to \u201CAzureServices\u201D. If azurerm_storage_account_network_rules\
      \ resource is being used, set the bypass argument to \u201CAzureServices\u201D\
      ."
  resource_type:
  - storage
  rule_id: non_car_storage_account_network_access_trusted_azure_services
  rule_type: non_context_aware
  security_layer: networking
  severity: medium
- cloud_provider: azure
  description: Cloudrail will review the App Services configuration in your environment.
    If an app does not have diagnostic logs enabled (detailed error messages, HTTP
    logging, and failed requests tracing), Cloudrail will highlight it as a violation.
  human_readable_logic: Cloudrail will review the App Service configuration within
    your Azure subscription and Terraform plan to check if diagnostic logs are enabled.
  name: Ensure diagnostic logs are enabled in App Services
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/app-service/troubleshoot-diagnostic-logs>
      in order to enable diagnostics logging for apps in App Service.
    terraform: For the azurerm_app_service resource, set the log block with detailed_error_messages_enabled
      argument set to true, failed_request_tracing_enabled argument set to true, and
      http_logs block with either file_system or azure_blob_storage arguments set.
  resource_type:
  - compute
  rule_id: non_car_diagnostic_logs_enabled_in_app_services
  rule_type: non_context_aware
  security_layer: logging
  severity: medium
- cloud_provider: azure
  description: Cloudrail will review the Kubernetes cluster configuration in your
    environment. If a cluster is not configured with role-based access control (RBAC)
    enabled, Cloudrail will highlight it as a violation.
  human_readable_logic: Cloudrail will review the Kubernetes clusters configuration
    within your Azure subscription and Terraform plan to ensure role-based access
    control is enabled.
  name: Ensure Kubernetes cluster has Role-Based Access Control (RBAC) enabled
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/aks/manage-azure-rbac>
      in order to enable RBAC for a Kubernetes cluster.
    terraform: For the azurerm_kubernetes_cluster resource, in the role_based_access_control
      block set the enabled argument to true.
  resource_type:
  - kubernetes
  rule_id: non_car_kubernetes_cluster_rbac_enabled
  rule_type: non_context_aware
  security_layer: iam
  severity: medium
- cloud_provider: azure
  description:
    params:
    - RDP
    template: vm_not_publicly_accessible_description
  human_readable_logic:
    params:
    - RDP
    - 3389
    template: vm_not_publicly_accessible_human_readable_name
  name:
    params:
    - RDP
    template: vm_not_publicly_accessible_name
  remediation_steps:
    console:
      params:
      - RDP
      template: vm_not_publicly_accessible_console_remediation_steps
    terraform:
      params:
      - RDP
      template: vm_not_publicly_accessible_iac_remediation_steps
  resource_type:
  - network
  rule_id: car_vm_not_publicly_accessible_rdp
  rule_type: context_aware
  security_layer: networking
  severity: major
- cloud_provider: azure
  description:
    params:
    - SSH
    template: vm_not_publicly_accessible_description
  human_readable_logic:
    params:
    - SSH
    - 22
    template: vm_not_publicly_accessible_human_readable_name
  name:
    params:
    - SSH
    template: vm_not_publicly_accessible_name
  remediation_steps:
    console:
      params:
      - SSH
      template: vm_not_publicly_accessible_console_remediation_steps
    terraform:
      params:
      - SSH
      template: vm_not_publicly_accessible_iac_remediation_steps
  resource_type:
  - network
  rule_id: car_vm_not_publicly_accessible_ssh
  rule_type: context_aware
  security_layer: networking
  severity: major
- cloud_provider: azure
  description: Cloudrail will review the unattached Managed Disks configuration in
    your environment. If a disk is not encrypted, Cloudrail will highlight it as a
    violation.
  human_readable_logic: Cloudrail will review the unattached Managed Disks configuration
    within your Azure subscription and Terraform plan to ensure they are encrypted.
    To find unattached disks on the TF plan, the azurerm_virtual_machine_data_disk_attachment
    resources should be scanned.
  name: Ensure unattached Managed Disk are encrypted
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/virtual-machines/disk-encryption>
      to enable disk encryption.
    terraform: For the azurerm_managed_disk resource, set the encryption_settings
      block with enabled argument set to true, or create an azurerm_disk_encryption_set
      resource and set the disk_encryption_set_id argument.
  resource_type:
  - storage
  rule_id: non_car_unattached_managed_disks_encrypted
  rule_type: non_context_aware
  security_layer: encryption
  severity: medium
- cloud_provider: azure
  description: Cloudrail will review the Web Apps configuration in your environment. If an app does not have client certificates enabled, Cloudrail will highlight it as a violation.
  human_readable_logic: Cloudrail will review the Web Apps configuration within your Azure subscription and Terraform plan to ensure client certificates are enabled.
  name: Ensure client certificates are required in Web App
  remediation_steps:
    console: Follow the guide at <https://docs.microsoft.com/en-us/azure/app-service/app-service-web-configure-tls-mutual-auth> in order to enable client certificates for Web App.
    terraform: For the azurerm_app_service resource, set the client_cert_enabled argument to true.
  resource_type:
  - compute
  rule_id: non_car_client_certificates_required_in_web_app
  rule_type: non_context_aware
  security_layer: iam
  severity: medium
- cloud_provider: azure
  description:
    Cloudrail will review the Virtual Machines and Virtual Machine Scale Sets configuration in your environment.
    If they are using unmanaged disks, Cloudrail will highlight it as a violation.
  human_readable_logic:
    Cloudrail will review the Virtual Machines and Virtual Machines Scale Sets configuration within your Azure subscription and Terraform plan to ensure they are using Managed Disks.
  name: Ensure Virtual Machines and Virtual Machine Scale Sets only use managed disks
  remediation_steps:
    console:
      Follow the guide at <https://docs.microsoft.com/en-us/azure/virtual-machines/managed-disks-overview> in order to attach managed disks to a Virtual Machine. Follow the guide at <https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/tutorial-use-disks-powershell> in order to attache managed disk to a Virtual Machine Scale Set.
    terraform:
      For the azurerm_virtual_machine resource, in storage_data_disk and storage_os_disk blocks, remove the vhd_uri argument and set the managed_disk_type and managed_disk_id arguments or create an azurerm_virtual_machine_data_disk_attachment resource. For azurerm_virtual_machine_scale_set resource, in storage_profile_os_disk block, remove the vhd_containers argument and set the managed_disk_type argument; in storage_profile_data_disk block, set the managed_disk_type argument.
  resource_type:
  - compute
  rule_id: non_car_virtual_machines_and_virtual_machine_scale_sets_only_use_managed_disks
  rule_type: non_context_aware
  security_layer: storage
  severity: medium
- cloud_provider: azure
  description:
    Cloudrail will review the Function Apps configuration in your environment.
    If a function of kind “functionapp” or “linux” is not using the latest Azure supported Java version (11), Cloudrail will highlight it as a violation.
  human_readable_logic:
    Cloudrail will review the Function Apps configuration within your Azure subscription and Terraform plan to ensure that, if they are of kind “functionapp” or “linux”, they are using the latest Azure supported Java version (11).
    You will need to check the resource azurerm_app_service_plan, associated to the Function app (app_service_plan_id), in order to get the “kind” argument.
  name: Ensure Function App is using the latest Azure supported Java version (11)
  remediation_steps:
    console:
      Follow the guide at <https://docs.microsoft.com/en-gb/azure/azure-functions/functions-reference-java> in order to set the latest Java version for the Function app.
    terraform:
       For the azurerm_function_app resource, in site_config block, set the linux_fx_version argument to “JAVA|11”.
  resource_type:
    - compute
  rule_id: non_car_function_app_using_latest_java_version
  rule_type: non_context_aware
  security_layer: runtime
  severity: medium
- cloud_provider: azure
  description:
    Cloudrail will review the PostgreSQL servers configuration in your environment. If a server does not have log disconnections enabled, Cloudrail will highlight it as a violation.
  human_readable_logic:
    Cloudrail will review the PostgreSQL Servers configuration within your Azure subscription and Terraform plan to ensure that the configuration name "log_disconnections" has value argument set to "on".
  name: Ensure PostgreSQL Servers have log disconnections enabled
  remediation_steps:
    console:
      Follow the guide at <https://docs.microsoft.com/en-us/azure/postgresql/howto-configure-server-parameters-using-portal> in order to set log_disconnections parameter to ON.
    terraform:
      For the azurerm_postgresql_configuration resource with the name argument set to “log_disconnections”, set the value argument to “on”. If this resource does not exist, create it with those arguments settings.
  resource_type:
  - database
  rule_id: non_car_postgresql_server_log_disconnections_enabled
  rule_type: non_context_aware
  security_layer: networking
  severity: medium